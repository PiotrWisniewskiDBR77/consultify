
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify[39m

[90mstdout[2m | tests/integration/storage_security.test.js
[22m[39mConnected to the SQLite database.
Created billing tables and seeded default subscription plans.

[90mstderr[2m | tests/integration/storage_security.test.js
[22m[39mWarning: Cannot access the `require` function: "TypeError [ERR_INVALID_ARG_VALUE]: The argument 'filename' must be a file URL object, file URL string, or absolute path string. Received 'http://localhost:3000/index.cjs'".
Warning: Cannot polyfill `ImageData`, rendering may be broken.
Warning: Cannot polyfill `Path2D`, rendering may be broken.

[90mstdout[2m | tests/integration/storage_security.test.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
[Scheduler] Initializing Cron Jobs...
[Scheduler] Jobs scheduled: Retention (Daily 3AM), Reconciliation (Weekly Sun 4AM)
[Redis] Initializing client...
[Redis] Using Mock Client

[90mstdout[2m | tests/integration/storage_security.test.js[2m > [22m[2mStorage Security & Isolation Integration
[22m[39mConnected to the SQLite database.
Created billing tables and seeded default subscription plans.

[90mstderr[2m | tests/integration/storage_security.test.js[2m > [22m[2mStorage Security & Isolation Integration
[22m[39mAggregateError: 
[90m    at internalConnectMultiple (node:net:1134:18)[39m
[90m    at afterConnectMultiple (node:net:1715:7)[39m {
  code: [32m'ECONNREFUSED'[39m,
  [errors]: [
    Error: connect ECONNREFUSED ::1:6379
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m6379[39m
    },
    Error: connect ECONNREFUSED 127.0.0.1:6379
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m6379[39m
    }
  ]
}

[90mstderr[2m | tests/integration/storage_security.test.js[2m > [22m[2mStorage Security & Isolation Integration
[22m[39mValidationError: The hit count for ::/56 was incremented more than once for a single request. See https://express-rate-limit.github.io/ERR_ERL_DOUBLE_COUNT/ for more information.
    at Object.singleCount [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4mexpress-rate-limit[24m/dist/index.cjs:436:13[90m)[39m
    at Object.wrappedValidations.<computed> [as singleCount] [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4mexpress-rate-limit[24m/dist/index.cjs:680:22[90m)[39m
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4mexpress-rate-limit[24m/dist/index.cjs:863:26
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4mexpress-rate-limit[24m/dist/index.cjs:825:5 {
  code: [32m'ERR_ERL_DOUBLE_COUNT'[39m,
  help: [32m'https://express-rate-limit.github.io/ERR_ERL_DOUBLE_COUNT/'[39m
}

[90mstdout[2m | tests/integration/storage_security.test.js[2m > [22m[2mStorage Security & Isolation Integration
[22m[39mLogin A Failed: [33m404[39m { error: [32m'User not found'[39m }

[90mstdout[2m | tests/integration/storage_security.test.js[2m > [22m[2mStorage Security & Isolation Integration
[22m[39mLogin B Failed: [33m404[39m { error: [32m'User not found'[39m }

 [31mâ¯[39m tests/integration/storage_security.test.js [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[32m 210[2mms[22m[39m
     [2m[90mâ†“[39m[22m should NOT allow User B to see files uploaded by User A
     [2m[90mâ†“[39m[22m should block upload if project storage limit is exceeded
     [2m[90mâ†“[39m[22m should sanitize filenames preventing directory traversal
     [2m[90mâ†“[39m[22m should soft delete files instead of removing them immediately

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/integration/storage_security.test.js[2m > [22mStorage Security & Isolation Integration
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m tests/integration/storage_security.test.js:[2m69:24[22m[39m
    [90m 67| [39m        tokenB [33m=[39m resB[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m 68| [39m
    [90m 69| [39m        [34mexpect[39m(tokenA)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m 70| [39m        [34mexpect[39m(tokenB)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 71| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [33m4 skipped[39m[90m (4)[39m
[2m   Start at [22m 13:11:23
[2m   Duration [22m 1.56s[2m (transform 59ms, setup 88ms, import 650ms, tests 210ms, environment 493ms)[22m

JUNIT report written to /Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/junit.xml
