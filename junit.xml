<?xml version="1.0" encoding="UTF-8" ?>
<testsuites name="vitest tests" tests="135" failures="1" errors="0" time="2.558445459">
    <testsuite name="tests/unit/backend/activityService.test.js" timestamp="2025-12-13T10:08:41.963Z" hostname="MacBook-Air-Piotr.local" tests="6" failures="0" errors="0" skipped="0" time="0.680998292">
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; log &gt; logs activity with all parameters" time="0.103180042">
        </testcase>
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; log &gt; handles optional parameters" time="0.106183625">
        </testcase>
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; getRecent &gt; fetches recent activities with default limit" time="0.107229917">
        </testcase>
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; getRecent &gt; fetches recent activities with custom limit" time="0.103678041">
        </testcase>
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; getRecent &gt; handles database errors gracefully" time="0.00083975">
        </testcase>
        <testcase classname="tests/unit/backend/activityService.test.js" name="Backend Service Test: ActivityService &gt; getByOrganization &gt; fetches activities for organization" time="0.10190875">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/aiService.test.js" timestamp="2025-12-13T10:08:41.964Z" hostname="MacBook-Air-Piotr.local" tests="26" failures="0" errors="0" skipped="3" time="0.076898917">
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; callLLM &gt; should use Google Gemini by default if checks pass" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; callLLM &gt; should block if balance is insufficient" time="0.035305583">
            <system-out>
[DB:lc9bt] Initializing database at :memory:
Connected to the SQLite database.
Created billing tables and seeded default subscription plans.
Seeded SuperAdmin and DBR77 Users.

            </system-out>
            <system-err>
LLM Call Error Error: Insufficient token balance. Please top up.
    at Object.callLLM [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/services/aiService.js:114:27[90m)[39m
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mtests/unit/backend/aiService.test.js:130:13
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

            </system-err>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; callLLM &gt; should call OpenAI via fetch when provider is openai" time="0.0013295">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; callLLM &gt; should call Anthropic via fetch when provider is anthropic" time="0.00017125">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; generateInitiatives &gt; should parse JSON response correctly" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; generateInitiatives &gt; should return empty array on JSON parse error" time="0.015495875">
            <system-out>
Projects table created successfully (or already exists).

Database initialization complete.

            </system-out>
            <system-err>
LLM Call Error Error: AI Provider not configured.
    at Object.callLLM [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/services/aiService.js:156:41[90m)[39m
    at Object.generateInitiatives [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/services/aiService.js:591:29[90m)[39m
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mtests/unit/backend/aiService.test.js:208:33
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

            </system-err>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; streamLLM &gt; should yield chunks from Gemini stream" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; streamLLM &gt; should handle errors in stream" time="0.000713167">
            <system-err>
Stream LLM Error Error: AI Provider not configured.
    at Object.streamLLM [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/services/aiService.js:382:41[90m)[39m
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mtests/unit/backend/aiService.test.js:236:30
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

            </system-err>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; buildRoadmap &gt; should return roadmap object on success" time="0.000567459">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; buildRoadmap &gt; should return empty object on error" time="0.012081916">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; suggestTasks &gt; should return tasks array on success" time="0.001593791">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; deepDiagnose &gt; should execute chain of thought and return diagnosis" time="0.000764625">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; enrichInitiative &gt; should maintain structure and fallback to LLM" time="0.000461667">
            <system-err>
Web Search failed, using LLM knowledge Error: Web Fail
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mtests/unit/backend/aiService.test.js:306:59
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

            </system-err>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; generateObservations &gt; should return observations from feedback" time="0.000591125">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Generation Methods &gt; testProviderConnection &gt; should test OpenAI connection" time="0.000305875">
            <system-out>
[AiService] Testing connection for: openai

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; enhancePrompt &gt; should return base system role when no extras found" time="0.00014475">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; enhancePrompt &gt; should inject global strategies" time="0.000088375">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; enhancePrompt &gt; should inject client context when orgId provided" time="0.00019575">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Queue Operations &gt; should enqueue task and return jobId" time="0.000445041">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Queue Operations &gt; should get job status" time="0.000311125">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Queue Operations &gt; should return null for non-existent job" time="0.000068458">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Vision Capabilities &gt; should format payload correctly for OpenAI Vision" time="0.000212167">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Vision Capabilities &gt; should use Gemini 1.5 Flash for vision fallback" time="0.000865292">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Advanced Streaming &gt; should parse OpenAI SSE stream correctly" time="0.000225167">
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Advanced Streaming &gt; should handle OpenAI stream error" time="0.000384208">
            <system-err>
Stream LLM Error Error: Stream Error
    at [90m/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mtests/unit/backend/aiService.test.js:232:69
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (&lt;anonymous&gt;)
    at runWithTimeout [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

            </system-err>
        </testcase>
        <testcase classname="tests/unit/backend/aiService.test.js" name="AIService Unit Tests &gt; Provider Integrations &gt; should generate JWT for Zhipu AI provider" time="0.003395333">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/aiService_additional.test.js" timestamp="2025-12-13T10:08:41.966Z" hostname="MacBook-Air-Piotr.local" tests="6" failures="0" errors="0" skipped="4" time="0.002453">
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.testProviderConnection &gt; tests OpenAI connection via fetch" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.testProviderConnection &gt; tests Anthropic connection via fetch" time="0.000842917">
            <system-out>
[AiService] Testing connection for: anthropic

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.testProviderConnection &gt; tests Gemini connection via GoogleGenerativeAI" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.callLLM fallback to Gemini &gt; uses Gemini when no provider config" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.streamLLM Gemini streaming &gt; yields chunks from Gemini stream" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/aiService_additional.test.js" name="AIService.generateObservations &gt; processes feedback and returns observations" time="0.000798625">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/analyticsService.test.js" timestamp="2025-12-13T10:08:41.966Z" hostname="MacBook-Air-Piotr.local" tests="5" failures="0" errors="0" skipped="0" time="0.090139833">
        <testcase classname="tests/unit/backend/analyticsService.test.js" name="AnalyticsService - Integration &gt; logUsage &gt; should log AI usage to the database without errors" time="0.001787917">
        </testcase>
        <testcase classname="tests/unit/backend/analyticsService.test.js" name="AnalyticsService - Integration &gt; getStats &gt; should retrieve aggregated stats from real database" time="0.003218625">
        </testcase>
        <testcase classname="tests/unit/backend/analyticsService.test.js" name="AnalyticsService - Integration &gt; getTopTopics &gt; should retrieve top topics from real database" time="0.000623792">
        </testcase>
        <testcase classname="tests/unit/backend/analyticsService.test.js" name="AnalyticsService - Integration &gt; saveMaturityScore &gt; should save maturity score without errors" time="0.000418166">
        </testcase>
        <testcase classname="tests/unit/backend/analyticsService.test.js" name="AnalyticsService - Integration &gt; getIndustryBenchmarks &gt; should retrieve industry benchmarks from real database" time="0.000490208">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/billingService.test.js" timestamp="2025-12-13T10:08:41.967Z" hostname="MacBook-Air-Piotr.local" tests="4" failures="0" errors="0" skipped="0" time="0.037727875">
        <testcase classname="tests/unit/backend/billingService.test.js" name="BillingService (Unit) &gt; getPlans &gt; should return all available plans from database" time="0.002273292">
        </testcase>
        <testcase classname="tests/unit/backend/billingService.test.js" name="BillingService (Unit) &gt; getPlans &gt; should handle database errors gracefully" time="0.000175667">
        </testcase>
        <testcase classname="tests/unit/backend/billingService.test.js" name="BillingService (Unit) &gt; createPlan &gt; should create a new plan successfully" time="0.000272458">
        </testcase>
        <testcase classname="tests/unit/backend/billingService.test.js" name="BillingService (Unit) &gt; getOrganizationBilling &gt; should return billing info from database" time="0.0002455">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/emailService.test.js" timestamp="2025-12-13T10:08:41.967Z" hostname="MacBook-Air-Piotr.local" tests="5" failures="0" errors="0" skipped="0" time="0.087875292">
        <testcase classname="tests/unit/backend/emailService.test.js" name="Backend Service Test: EmailService &gt; sendEmail &gt; sends email with default config" time="0.001995416">
        </testcase>
        <testcase classname="tests/unit/backend/emailService.test.js" name="Backend Service Test: EmailService &gt; sendEmail &gt; uses SMTP settings from database" time="0.054175167">
        </testcase>
        <testcase classname="tests/unit/backend/emailService.test.js" name="Backend Service Test: EmailService &gt; sendEmail &gt; handles database errors gracefully" time="0.001026375">
        </testcase>
        <testcase classname="tests/unit/backend/emailService.test.js" name="Backend Service Test: EmailService &gt; sendEmail &gt; logs email details" time="0.001787958">
        </testcase>
        <testcase classname="tests/unit/backend/emailService.test.js" name="Backend Service Test: EmailService &gt; sendEmail &gt; uses environment variables when database settings are missing" time="0.00094775">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/feedbackService.test.js" timestamp="2025-12-13T10:08:41.967Z" hostname="MacBook-Air-Piotr.local" tests="6" failures="0" errors="0" skipped="0" time="0.624144">
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; saveFeedback &gt; saves feedback with all parameters" time="0.10397075">
        </testcase>
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; saveFeedback &gt; saves feedback without correction" time="0.101412792">
        </testcase>
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; getLearningExamples &gt; retrieves learning examples for context" time="0.112260375">
        </testcase>
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; getLearningExamples &gt; handles empty results" time="0.005303292">
        </testcase>
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; getLearningExamples &gt; handles database errors gracefully" time="0.004517458">
        </testcase>
        <testcase classname="tests/unit/backend/feedbackService.test.js" name="Backend Service Test: FeedbackService &gt; getLearningExamples &gt; only returns examples with rating &gt;= 4" time="0.101442708">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/financialService.test.js" timestamp="2025-12-13T10:08:41.968Z" hostname="MacBook-Air-Piotr.local" tests="10" failures="0" errors="0" skipped="0" time="0.002728375">
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateCost &gt; returns correct cost for High complexity" time="0.000575125">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateCost &gt; returns correct cost for Medium complexity" time="0.000083542">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateCost &gt; returns correct cost for Low complexity" time="0.00006">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateBenefit &gt; calculates benefit for High priority" time="0.000078834">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateBenefit &gt; calculates benefit for Medium priority" time="0.000066959">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateBenefit &gt; calculates benefit for Low priority" time="0.000049083">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; estimateBenefit &gt; returns High benefit range for large benefits" time="0.000043792">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; simulatePortfolio &gt; calculates portfolio economics correctly" time="0.000544958">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; simulatePortfolio &gt; handles empty portfolio" time="0.000424416">
        </testcase>
        <testcase classname="tests/unit/backend/financialService.test.js" name="Backend Service Test: FinancialService &gt; simulatePortfolio &gt; uses custom revenue base" time="0.000075334">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/knowledgeService.test.js" timestamp="2025-12-13T10:08:41.968Z" hostname="MacBook-Air-Piotr.local" tests="11" failures="0" errors="0" skipped="0" time="0.142097791">
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Candidate Management &gt; should add a candidate idea without throwing" time="0.002906417">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Candidate Management &gt; should get candidates without throwing" time="0.001269167">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Strategies &gt; should add a global strategy without throwing" time="0.000552084">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Strategies &gt; should get active strategies without throwing" time="0.000542">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Client Context &gt; should set and get client context" time="0.0019325">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Client Context &gt; should update existing client context" time="0.003365291">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Candidate Status &gt; should update candidate status" time="0.001853208">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Process Document (RAG) &gt; should process document chunks" time="0.033729209">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Access Control &gt; should restrict user access to project docs" time="0.002053">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Strategies Toggle &gt; should toggle strategy active status" time="0.001248583">
        </testcase>
        <testcase classname="tests/unit/backend/knowledgeService.test.js" name="KnowledgeService - Integration &gt; Document Lifecycle &gt; should soft delete document" time="0.003299375">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/ragService.test.js" timestamp="2025-12-13T10:08:41.969Z" hostname="MacBook-Air-Piotr.local" tests="5" failures="0" errors="0" skipped="0" time="0.092733875">
        <testcase classname="tests/unit/backend/ragService.test.js" name="RagService - Integration &gt; generateEmbedding &gt; should return null if no provider configured in database" time="0.026820333">
            <system-out>
[DB:1a2h2x] Initializing database at :memory:
Connected to the SQLite database.
Created billing tables and seeded default subscription plans.
Seeded SuperAdmin and DBR77 Users.

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/ragService.test.js" name="RagService - Integration &gt; getContext &gt; should return context string without throwing" time="0.030550167">
            <system-out>
Projects table created successfully (or already exists).

Database initialization complete.

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/ragService.test.js" name="RagService - Integration &gt; getContext &gt; should accept limit parameter" time="0.00059925">
        </testcase>
        <testcase classname="tests/unit/backend/ragService.test.js" name="RagService - Integration &gt; getContextKeyword &gt; should perform keyword search without throwing" time="0.000508083">
        </testcase>
        <testcase classname="tests/unit/backend/ragService.test.js" name="RagService - Integration &gt; getAxisDefinitions &gt; should retrieve axis definitions without throwing" time="0.000549958">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/tokenBillingService.test.js" timestamp="2025-12-13T10:08:41.969Z" hostname="MacBook-Air-Piotr.local" tests="16" failures="0" errors="0" skipped="0" time="0.226088917">
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Margins &gt; should get margins without throwing" time="0.001524334">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Margins &gt; should get specific margin by source type" time="0.000418375">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Packages &gt; should get packages without throwing" time="0.000627084">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Packages &gt; should upsert package without throwing" time="0.000698166">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Balance &gt; should get balance without throwing" time="0.000195625">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Balance &gt; should ensure balance creates record" time="0.000340791">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Balance &gt; should credit tokens to user" time="0.002877375">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Balance Check &gt; should check sufficient balance" time="0.00117425">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Margin Updates &gt; should update margin and persist changes" time="0.000762416">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Token Deduction / Usage &gt; should deduct tokens correctly for platform usage" time="0.003100334">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Token Deduction / Usage &gt; should handle markup multipliers" time="0.002198459">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; User API Keys (BYOK) &gt; should add, get and delete user API keys" time="0.060069916">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Source Determination &gt; should prefer BYOK if available and requested" time="0.056563583">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Source Determination &gt; should fallback to platform if no BYOK key" time="0.000904208">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Analytics &gt; should retrieve revenue analytics" time="0.001397625">
        </testcase>
        <testcase classname="tests/unit/backend/tokenBillingService.test.js" name="TokenBillingService - Integration &gt; Analytics &gt; should retrieve transactions for user" time="0.00064175">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/usageService.test.js" timestamp="2025-12-13T10:08:41.970Z" hostname="MacBook-Air-Piotr.local" tests="4" failures="0" errors="0" skipped="0" time="0.09636125">
        <testcase classname="tests/unit/backend/usageService.test.js" name="UsageService - Integration &gt; Record Usage &gt; should record token usage without throwing" time="0.001765333">
        </testcase>
        <testcase classname="tests/unit/backend/usageService.test.js" name="UsageService - Integration &gt; Record Usage &gt; should record storage usage without throwing" time="0.000598375">
        </testcase>
        <testcase classname="tests/unit/backend/usageService.test.js" name="UsageService - Integration &gt; Get Usage &gt; should get current usage without throwing" time="0.002186459">
        </testcase>
        <testcase classname="tests/unit/backend/usageService.test.js" name="UsageService - Integration &gt; Check Quota &gt; should check quota without throwing" time="0.001057667">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/adminMiddleware.test.js" timestamp="2025-12-13T10:08:41.970Z" hostname="MacBook-Air-Piotr.local" tests="4" failures="0" errors="0" skipped="0" time="0.008794709">
        <testcase classname="tests/unit/backend/middleware/adminMiddleware.test.js" name="AdminMiddleware &gt; should call next() if user is admin" time="0.005299708">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/adminMiddleware.test.js" name="AdminMiddleware &gt; should call next() if user is superadmin" time="0.000479">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/adminMiddleware.test.js" name="AdminMiddleware &gt; should return 403 if user is not admin" time="0.001277708">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/adminMiddleware.test.js" name="AdminMiddleware &gt; should return 401 if verify failed (bad signature)" time="0.000280417">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/auditLog.test.js" timestamp="2025-12-13T10:08:41.970Z" hostname="MacBook-Air-Piotr.local" tests="3" failures="0" errors="0" skipped="0" time="0.1239725">
        <testcase classname="tests/unit/backend/middleware/auditLog.test.js" name="AuditLog Middleware &gt; should call next() and override res.end" time="0.066543541">
            <system-out>
[Database] Selected: SQLite

[DB:kqzcya] Initializing database at :memory:
Connected to the SQLite database.
Created billing tables and seeded default subscription plans.
Seeded SuperAdmin and DBR77 Users.

Projects table created successfully (or already exists).

Database initialization complete.

[Database] Selected: SQLite

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/middleware/auditLog.test.js" name="AuditLog Middleware &gt; should log activity when res.end is called for 2xx POST" time="0.053880542">
            <system-out>
[Database] Selected: SQLite

            </system-out>
        </testcase>
        <testcase classname="tests/unit/backend/middleware/auditLog.test.js" name="AuditLog Middleware &gt; should NOT log for GET requests" time="0.002731833">
            <system-out>
[Database] Selected: SQLite

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/authMiddleware.test.js" timestamp="2025-12-13T10:08:41.971Z" hostname="MacBook-Air-Piotr.local" tests="6" failures="0" errors="0" skipped="4" time="0.0040845">
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should return 403 if no token provided" time="0.002364625">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should return 401 if token expired" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should return 401 if token invalid" time="0.0003645">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should call next() if token valid and no revocation check needed (no jti)" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should check revocation if jti is present" time="0">
            <skipped/>
        </testcase>
        <testcase classname="tests/unit/backend/middleware/authMiddleware.test.js" name="AuthMiddleware &gt; should return 401 if token is revoked" time="0">
            <skipped/>
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/planLimits.test.js" timestamp="2025-12-13T10:08:41.971Z" hostname="MacBook-Air-Piotr.local" tests="1" failures="1" errors="0" skipped="0" time="0">
        <testcase classname="tests/unit/backend/middleware/planLimits.test.js" name="tests/unit/backend/middleware/planLimits.test.js" time="0">
            <failure message="Failed to parse source for import analysis because the content contains invalid JS syntax. If you are using JSX, make sure to name the file with the .jsx or .tsx extension." type="Error">
Error: Failed to parse source for import analysis because the content contains invalid JS syntax. If you are using JSX, make sure to name the file with the .jsx or .tsx extension.
  Plugin: vite:import-analysis
  File: /Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/tests/unit/backend/middleware/planLimits.test.js:133:5
  132|  });
  133|  ```
  134|  
     |  ^
 ❯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/dep-D4NMHUTW.js:42528:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-D4NMHUTW.js:42525:16
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-D4NMHUTW.js:40455:14
 ❯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/dep-D4NMHUTW.js:42323:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-D4NMHUTW.js:35739:27
            </failure>
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" timestamp="2025-12-13T10:08:41.972Z" hostname="MacBook-Air-Piotr.local" tests="6" failures="0" errors="0" skipped="0" time="0.110255792">
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should skip check if no project_id provided" time="0.001827333">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should allow request if quota is sufficient" time="0.001714125">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should allow request if limit is NULL (unlimited)" time="0.001062041">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should block 429 if quota exceeded" time="0.002942875">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should cleanup temp file if quota exceeded" time="0.00134">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/projectQuotaMiddleware.test.js" name="Project Quota Middleware (Integration) &gt; should handle errors gracefully (e.g. project not found)" time="0.002230459">
            <system-err>
Project quota check error: Error: Project not found
    at Statement.&lt;anonymous&gt; [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/services/usageService.js:300:41[90m)[39m
    at Statement.replacement [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4msqlite3[24m/lib/trace.js:25:27[90m)[39m
    at Statement.replacement [90m(/Users/piotrwisniewski/Documents/Antygracity/DRD/consultify/[39mserver/node_modules/[4msqlite3[24m/lib/trace.js:25:27[90m)[39m

            </system-err>
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/quotaMiddleware.test.js" timestamp="2025-12-13T10:08:41.972Z" hostname="MacBook-Air-Piotr.local" tests="8" failures="0" errors="0" skipped="0" time="0.142938583">
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceTokenQuota &gt; should return 401 if no orgId" time="0.00133275">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceTokenQuota &gt; should allow if usage is below limit" time="0.004042917">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceTokenQuota &gt; should block 429 if usage exceeds limit" time="0.00431825">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceTokenQuota &gt; should allow if overage is enabled even if exceeded" time="0.001698417">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceTokenQuota &gt; should set warning headers if &gt; 80%" time="0.001680084">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceStorageQuota &gt; should allow if allowed" time="0.001593125">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; enforceStorageQuota &gt; should block 429 if exceeded" time="0.002913792">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/quotaMiddleware.test.js" name="Quota Middleware (Integration) &gt; recordTokenUsageAfterResponse &gt; should insert usage record into DB" time="0.054236208">
        </testcase>
    </testsuite>
    <testsuite name="tests/unit/backend/middleware/superAdminMiddleware.test.js" timestamp="2025-12-13T10:08:41.973Z" hostname="MacBook-Air-Piotr.local" tests="3" failures="0" errors="0" skipped="0" time="0.008151958">
        <testcase classname="tests/unit/backend/middleware/superAdminMiddleware.test.js" name="SuperAdminMiddleware &gt; should call next() if user is superadmin" time="0.00446225">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/superAdminMiddleware.test.js" name="SuperAdminMiddleware &gt; should return 403 if user is admin (not super)" time="0.001932625">
        </testcase>
        <testcase classname="tests/unit/backend/middleware/superAdminMiddleware.test.js" name="SuperAdminMiddleware &gt; should return 401 if token is invalid (bad signature)" time="0.000624542">
        </testcase>
    </testsuite>
</testsuites>
